<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Habit Harmony</title>
  <style>
@font-face {
  font-family: 'Mansfield';
  src: url('fonts/Mansfield-Black-iF66c703e45fe6e.ttf') format('truetype');
  font-weight: 900;
  font-style: normal;
}
.auth-box {
  background: white;
  padding: 3rem;
  border-radius: 20px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  max-width: 600px; /* wider */
  width: 90%;
  margin: 2rem auto;
}


@font-face {
  font-family: 'Mansfield';
  src: url('fonts/Mansfield-Bold-iF66c703e473e0c.ttf') format('truetype');
  font-weight: 700;
  font-style: normal;
}
/* Fix #userTitle color in dark mode */
.low-light #userTitle {
  color: #ddddf7; /* Light lavender, very readable */
}

/* Fix small buttons (habit add/trash) in dark mode */
.low-light .btn-small {
  background: #6b21a8;
  color: white;
}
.low-light .btn-small:hover {
  background: #5a189a;
}

#onboarding {
  min-height: 600px;
  max-width: 1000px; /* ğŸŒŸ Add this line */
  width: 90%; /* ğŸŒŸ Add this line */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding-bottom: 2rem;
  transition: min-height 0.3s ease;
}
#habitbot-response {
  color: #555;
}
.low-light #habitbot-response {
  color: #ddddf7;
}



#progressBar {
  width: 100%;
  margin: 1rem auto;
}
#quiz-step-1, #quiz-step-2, #quiz-step-3 {
  width: 100%;
  max-width: 1000px; /* match onboarding width */
  display: flex;
  flex-direction: column;
  align-items: center;
}

.low-light .calendar td {
  background-color: #40407a; /* solid dark lavender background */
  color: #f5f5f5;
  border-radius: 8px;
}


.low-light .completed {
  background: #8b5cf6; /* soft purple */
  color: #1a1a1a;
}

.low-light .upcoming {
  background: #6b21a8; /* deeper purple */
  color: #1a1a1a;
}

.low-light .today {
  background: #a78bfa; /* Softer lilac highlight for today */
  color: #1a1a1a; /* Dark text on light highlight */
}
.low-light .btn-small {
  background: #a78bfa; /* Softer lilac */
  color: #1a1a1a; /* Dark icon color */
  border: 1px solid #c4b5fd; /* Optional: subtle border */
}
.low-light .btn-small:hover {
  background: #c4b5fd;
}


@font-face {
  font-family: 'Mansfield';
  src: url('fonts/Mansfield-Italic-iF66c703e4a6951.ttf') format('truetype');
  font-weight: 400;
  font-style: italic;
}

 @font-face {
  font-family: 'Mansfield';
  src: url('fonts/Mansfield-Semi-Bold-iF66c703e4e3977.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
}
@font-face {
  font-family: 'Satoshi';
  src: url('fonts/Satoshi-Regular.otf') format('opentype');
  font-weight: 400;
  font-style: normal;
}

@font-face {
  font-family: 'Satoshi';
  src: url('fonts/Satoshi-Bold.otf') format('opentype');
  font-weight: 700;
  font-style: normal;
}

@font-face {
  font-family: 'Satoshi';
  src: url('fonts/Satoshi-Light.otf') format('opentype');
  font-weight: 300;
  font-style: normal;
}

@font-face {
  font-family: 'Satoshi';
  src: url('fonts/Satoshi-Italic.otf') format('opentype');
  font-weight: 400;
  font-style: italic;
}


/* Layout */
body {
  font-family: 'Satoshi', sans-serif;
  font-weight: 400;
  min-height: 100vh;
  background: linear-gradient(to bottom right, #cfe0fc, #e2d4f9);
  color: #333;
  margin: 0;
  padding: 24px;
}

h1, h2, h3 {
  font-family: 'Mansfield', sans-serif;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin-bottom: 0.5rem;
  text-align: left;
}

h1 {
  font-size: 3.5rem;
  font-weight: 900; /* Mansfield Black */
}

h2, h3 {
  font-weight: 700; /* Mansfield Bold */
}
.card, .dashboard, .card * {
  font-family: 'Satoshi', sans-serif;
}


main {
  padding: 2rem;
  width: 90%;
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  align-items: center;
}

section {
  margin-bottom: 2rem;
}

header {
  text-align: center;
  padding: 2rem;
  background: none;
  border: none;
}

header h1 {
  margin: 0;
  font-size: 3rem;
  color: #6b21a8;
}

header p {
  font-size: 1.25rem;
  color: #555;
}

/* Buttons (global base for ALL buttons) */
button {
  font-family: 'Satoshi', sans-serif;
  font-weight: 700;
  font-size: 1rem;
  padding: 1rem 2.5rem;
  margin: 0.5rem 0;
  border-radius: 12px;
  font-weight: bold;
  border: none;
  cursor: pointer;
  transition: background 0.3s;
  width: auto;
  display: inline-block;
}
#quote {
  font-family: 'Satoshi', sans-serif;
  font-style: italic;
  font-weight: 400;
}


/* Primary (Purple) Button */
.button-primary {
  background: #7c3aed;
  color: white;
}

.button-primary:hover {
  background: #6b21a8;
}

/* Green Buttons (only if needed) */
.button-green {
  background: #28b485;
  color: white;
}

.button-green:hover {
  background: #249e76;
}

/* Secondary Gray Buttons (optional) */
.button-secondary {
  background: #f0f0f0;
  color: #333;
  border: 1px solid #ccc;
  font-weight: bold;
}

.button-secondary:hover {
  background: #e0e0e0;
}

/* Link-style Buttons */
.button-back-link {
  background: none;
  border: none;
  color: #666;
  font-size: 1rem;
  cursor: pointer;
  text-decoration: underline;
  font-weight: normal;
}

.button-back-link:hover {
  color: #333;
}


/* Inputs & Selects */
input, select {
  font-size: 1rem;
  padding: 0.75rem;
  margin: 0.5rem 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  width: 100%;
  box-sizing: border-box;
}

select {
  appearance: none;
  background-color: #ffffff;
  color: #333;
  background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='10' viewBox='0 0 14 10'%3E%3Cpath fill='%236b21a8' d='M7 10L0 0h14z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1rem center;
  background-size: 12px;
}

select:focus {
  outline: none;
  border-color: #7c3aed;
  box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
}

/* Dashboard Card */
.dashboard {
  background: white;
  padding: 2rem;
  border-radius: 16px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.1);
  margin-top: 2rem;
  max-width: 1000px; /* ADD THIS */
  width: 90%;         /* ADD THIS */
}

.card {
  background: white;
  border-radius: 16px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.1);
  padding: 24px;
  margin: 20px;
  flex: 1 1 300px;
  max-width: 360px;
}
@keyframes slideUpFade {
  0% { opacity: 0; transform: translateY(40px); }
  100% { opacity: 1; transform: translateY(0); }
}

h1, h2, h3 {
  animation: slideUpFade 0.8s ease both;
}



/* Other Small Components */
#progressBar {
  height: 10px;
  background: #e9d5ff;
  border-radius: 5px;
  overflow: hidden;
  margin: 1rem 0;
}

#progressFill {
  height: 100%;
  background: #7c3aed;
  width: 0;
  transition: width 0.5s ease;
}

#habitList {
  padding-left: 1rem;
}

.fade-in {
  animation: fadeIn 0.5s ease-in;
}

.fade-out {
  animation: fadeOut 0.5s ease-out;
}

@keyframes fadeIn {
  from {opacity: 0;}
  to {opacity: 1;}
}

@keyframes fadeOut {
  from {opacity: 1;}
  to {opacity: 0;}
}

/* Popup */
#welcomePopup h2 {
  color: #7c3aed;
}

#welcomePopup p {
  color: #666;
}

#welcomePopup button {
  background: #7c3aed;
  color: #fff;
}

#welcomePopup button:hover {
  background: #6b21a8;
}

/* Mobile Floating Username */
#userTitle {
  position: fixed;
  top: 10px;
  left: 20px;
  font-size: 1.2rem;
  color: #6b21a8;
  font-weight: bold;
  display: none;
  z-index: 1000;
}

/* Selected Quiz Buttons */
#goal-buttons button.selected,
#motivation-buttons button.selected,
#shortterm-buttons button.selected {
  background-color: #c4b5fd;
  color: #1a1a1a;
  font-weight: bold;
  border: 2px solid #7c3aed;
  transform: scale(1.05);
}
@keyframes popIn {
  0% { transform: scale(0.8); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

h1, h2, h3 {
  animation: popIn 0.6s ease-out;
}
body::before {
  content: "";
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background-image: url('https://grainy-gradients.vercel.app/noise.png');
  opacity: 0.07;
  pointer-events: none;
  z-index: 0;
}
body {
  transition: background 0.5s ease, color 0.5s ease;
}
.low-light {
  background: linear-gradient(to bottom right, #2c2c54, #40407a);
  color: #f5f5f5;
}

.low-light h1 {
  color: #c4b5fd; /* lighter, readable purple in dark mode */
}

.low-light h2, .low-light p {
  color: #ddddf7; /* much lighter grayish-blue for better contrast */
}

.low-light .dashboard, .low-light .card {
  background: #353567;
  border: 1px solid #55558c;
  box-shadow: 0 8px 16px rgba(0,0,0,0.6);
}

.low-light button {
  background: #575fcf;
  color: #ffffff;
}

.low-light button:hover {
  background: #4e54c8;
}

.low-light input, .low-light select {
  background-color: #45457a;
  color: #f5f5f5;
  border: 1px solid #6666aa;
}

.low-light input::placeholder, .low-light select::placeholder {
  color: #bbbbdd;
}

.low-light a {
  color: #b4b4ff;
}
.low-light a:hover {
  color: #ffffff;
}

h1 {
  font-size: 3rem;
  color: #6b21a8;
  margin-bottom: 0.5rem;
}
h2, p {
  color: #555;
}
.low-light .auth-box {
  background: #2c2c54;
  color: #f5f5f5;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
}
.card {
  background: white;
  border-radius: 16px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.1);
  padding: 24px;
  margin: 20px auto;
  max-width: 500px;
}
.btn {
  background: #7c3aed;
  color: white;
  padding: 8px 16px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  margin-top: 10px;
}
.btn-small {
  font-size: 14px;
  padding: 6px 10px;
  border-radius: 6px;
}
input, textarea {
  font-size: 1rem;
}

.input { border: 1px solid #ccc; padding: 8px; border-radius: 6px; flex: 1; }
.flex { display: flex; align-items: center; }
.justify-between { justify-content: space-between; }
.gap-2 { gap: 8px; }
.text-line { text-decoration: line-through; }
.calendar {
  margin: 0 auto;
}
.calendar td { padding: 8px; border-radius: 8px; }
.today { background: #7c3aed; color: white; }
.completed { background: #c4b5fd; color: white; }
.upcoming { background: #e9d5ff; }
ul { list-style: none; padding: 0; }
input[type="checkbox"] { width: 16px; height: 16px; }

.card {
  animation: slideFadeIn 0.6s ease-out both;
}

@keyframes slideFadeIn {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}
#menuDropdown {
  transition: max-height 0.4s ease, opacity 0.4s ease;
  overflow: hidden;
  max-height: 0;
  opacity: 0;
}
.low-light .btn-small {
  background: #a78bfa;
  color: #2c2c54; /* Darker navy color for better contrast */
  border: 1px solid #c4b5fd;
}

.low-light .btn-small:hover {
  background: #c4b5fd;
}
#menuDropdown.open {
  max-height: 500px; /* enough for all menu items */
  opacity: 1;
}
input::placeholder, select::placeholder {
  font-family: 'Satoshi', sans-serif;
  font-style: italic;
  font-weight: 300; /* Light */
  color: #888;
}
header h1 {
  text-align: center;
}
.low-light #menuDropdown {
  background: #353567;
  color: #f5f5f5;
  border: 1px solid #55558c;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
}
.low-light #menuDropdown button {
  background: none;
  color: #f5f5f5;
  border-bottom: 1px solid #55558c;
}
.low-light #menuDropdown button:hover {
  background: #4e54c8;
}
#menuDropdown {
  transition: max-height 0.4s ease, opacity 0.4s ease, background-color 0.3s ease;
}
.spinner {
  border: 4px solid #eee;
  border-top: 4px solid #7c3aed;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  animation: spin 0.8s linear infinite;
  margin: 1rem auto;
}

@keyframes spin {
  0% { transform: rotate(0deg);}
  100% { transform: rotate(360deg);}
}
#habit-list li {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  padding: 0.5rem 0;
  line-height: 1.4;
  font-size: 1rem;
  flex-direction: column;
}
.card {
  background: rgba(255, 255, 255, 0.8); /* transparent white */
  backdrop-filter: blur(8px);
  border-radius: 20px;
  box-shadow: 0 12px 28px rgba(0,0,0,0.15);
  transition: all 0.3s ease-in-out;
}
.low-light .card {
  background: rgba(53, 53, 103, 0.6);
  backdrop-filter: blur(10px);
  border: 1px solid #6b6ba8;
}
/* ğŸ” Enlarge HabitBot & Motivation Corner content */
.card[data-card-id="habitbot"] h3,
.card[data-card-id="motivation-corner"] h3 {
  font-size: 1.6rem;
  margin-bottom: 1rem;
}

.card[data-card-id="habitbot"] textarea,
.card[data-card-id="motivation-corner"] #quote {
  font-size: 1.2rem;
  line-height: 1.6;
}

.card[data-card-id="motivation-corner"] #author {
  font-size: 1rem;
#habitbotModal textarea {
  font-size: 1.2rem;
  padding: 1rem;
  width: 100%;
}

#habitbotModal button.btn-small {
  font-size: 1rem;
  padding: 0.75rem 1.5rem;
}

#habitbotModal > div {
  display: flex;
  flex-direction: column;
  align-items: center;
}
.card div[style*="height: 12px"] {
  background-color: #e5e7eb;
  border-radius: 6px;
  overflow: hidden;
  margin-top: 4px;
}
.card div[style*="height: 12px"] > div {
  background: #7c3aed;
  height: 100%;
  transition: width 0.3s ease-in-out;
}



</style>

</head>
<body>
  <input type="hidden" id="username" />
  <div id="userTitle"></div>

 <header>
  <div style="position: absolute; top: 10px; right: 20px; display: flex; align-items: center; gap: 12px;">
    <button id="themeToggle" style="background: none; border: none; font-size: 24px; cursor: pointer;">ğŸŒ™</button>
    <button id="menuButton" style="background: none; border: none; font-size: 28px; cursor: pointer;">â˜°</button>
    <div id="menuDropdown" style="display: none; position: absolute; top: 50px; right: 20px; border-radius: 8px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); overflow: hidden; z-index: 1000;">
      <button onclick="logoutUser()" style="display: block; width: 100%; padding: 10px; background: none; border: none; text-align: left; cursor: pointer;">ğŸšª Log Out</button>
      <button onclick="resetGoals()" style="display: block; width: 100%; padding: 10px; background: none; border: none; text-align: left; cursor: pointer;">â™»ï¸ Reset Goals</button>
      <button onclick="toggleTheme()" style="display: block; width: 100%; padding: 10px; background: none; border: none; text-align: left; cursor: pointer;">ğŸ¨ Toggle Theme</button>
    </div>
  </div>
  <h1>ğŸŒ± Habit Harmony <span id="time-icon">ğŸŒ</span></h1>
  <p id="datetime"></p>
</header>


  <main>
    <section id="auth-section">
      <div class="auth-box">
        <h2>Welcome to Habit Builder ğŸ‘‹</h2>
        <p>Create an account to start your journey:</p>
        <input type="text" id="auth-name" placeholder="Username" /><br />
        <div class="flex gap-2">
          <input type="password" id="auth-password" class="input" placeholder="Create a password" onkeyup="detectCapsLock(event, 'caps-warning-auth-password')" oninput="validatePasswordRules(this.value)">
          <button type="button" class="btn-small" onclick="togglePassword('auth-password')">ğŸ‘ï¸</button>
        </div>

        <p id="caps-warning-auth-password" style="color:red;display:none;">âš ï¸ Caps Lock is ON</p>
        <ul id="password-rules" style="font-size:0.9rem; color:gray; list-style: none; margin-top: 8px;">
          <li id="rule-length">âŒ 8+ characters</li>
          <li id="rule-uppercase">âŒ 1 uppercase letter</li>
          <li id="rule-number">âŒ 1 number</li>
        </ul>
        <div class="flex gap-2">
          <input type="password" id="auth-confirm-password" class="input" placeholder="Confirm your password" />
          <button type="button" class="btn-small" onclick="togglePassword('auth-confirm-password')">ğŸ‘ï¸</button>
        </div>

        <p id="caps-warning-auth-confirm-password" style="color:red;display:none;">âš ï¸ Caps Lock is ON</p>
        <select id="security-question">
          <option value="" disabled selected>Select a security question</option>
          <option value="What was your childhood nickname?">What was your childhood nickname?</option>
          <option value="In what city were you born?">In what city were you born?</option>
          <option value="What is your favorite movie?">What is your favorite movie?</option>
          <option value="What was your first petâ€™s name?">What was your first petâ€™s name?</option>
          <option value="What elementary school did you attend?">What elementary school did you attend?</option>
          <option value="What is your motherâ€™s maiden name?">What is your motherâ€™s maiden name?</option>
          <option value="What was your dream job as a child?">What was your dream job as a child?</option>
          <option value="What is your favorite food?">What is your favorite food?</option>
          <option value="What is your favorite book?">What is your favorite book?</option>
          <option value="What was the make of your first car?">What was the make of your first car?</option>
        </select><br />

        <input type="text" id="security-answer" placeholder="Answer to your question" /><br />
        <button onclick="completeSignup()">Create Account</button>
        <p style="text-align: center;">
          Already have an account? <a href="#" onclick="showLogin()">Log in</a>
        </p>
      </div>
    </section>
    
    <section id="login-section" style="display: none;">
      <div class="auth-box">
        <h2>Welcome Back ğŸ‘‹</h2>
        <p>Log in to continue building your habits:</p>
        <input type="text" id="login-name" placeholder="Your name" /><br />
        <div class="flex gap-2">
          <input type="password" id="login-password" class="input" placeholder="Your password" />
          <button type="button" class="btn-small" onclick="togglePassword('login-password')">ğŸ‘ï¸</button>
        </div>
        <p id="caps-warning-new-password" style="color:red;display:none;">âš ï¸ Caps Lock is ON</p>
        <button class="button-primary" onclick="loginUser()">Log In</button>
        <p style="text-align: center;">
          <a href="#" onclick="showPasswordReset()">Forgot your password?</a>
        </p>
        <p style="text-align: center;">
          New here? <a href="#" onclick="showSignup()">Create an account</a>
        </p>
      </div>
    </section>
    
    <section id="reset-section" style="display: none;">
      <div class="auth-box">
        <h2>Reset Your Password ğŸ”‘</h2>
        <input type="text" id="reset-name" placeholder="Your username" /><br />
        <p id="securityQuestionDisplay" style="font-style: italic; color: #555;"></p>
        <input type="text" id="reset-answer" placeholder="Answer to your security question" style="display: none;" /><br />
        <input type="password" id="new-password" placeholder="New password" style="display: none;" /><br />
        <button type="button" class="btn-small" onclick="togglePassword('new-password')">ğŸ‘ï¸</button>
        <p id="caps-warning-new-password" style="color:red;display:none;">âš ï¸ Caps Lock is ON</p>
        <button onclick="handleReset()" id="resetActionBtn">Next</button><br />
        <p style="text-align: center;">
          <a href="#" onclick="backToLogin()">Back to login</a>
        </p>
      </div>
    </section>
    


    <section id="onboarding" style="display: none;">
      <div id="progressBar">
        <div id="progressFill"></div>
      </div>
     <h2 id="onboarding-heading">Hi there!</h2>
      <p id="onboarding-subheading">Letâ€™s make a plan just for you. Whatâ€™s something you want to build into your life?</p>
    

      <div id="quiz-step-1">
        <p>Choose up to 3 long-term priorities:</p>
        <div id="goal-buttons" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
          <button onclick="toggleGoal(this, 'Improve Physical Health')">ğŸ’ª Improve Physical Health</button>
          <button onclick="toggleGoal(this, 'Boost Mental Well-Being')">ğŸ§  Boost Mental Well-Being</button>
          <button onclick="toggleGoal(this, 'Advance Career or Education')">ğŸ“ Advance Career or Education</button>
          <button onclick="toggleGoal(this, 'Build Financial Stability')">ğŸ’° Build Financial Stability</button>
          <button onclick="toggleGoal(this, 'Strengthen Relationships')">ğŸ¤ Strengthen Relationships</button>
          <button onclick="toggleGoal(this, 'Enhance Creativity or Hobbies')">ğŸ¨ Enhance Creativity or Hobbies</button>
          <button onclick="toggleGoal(this, 'Establish a Daily Routine')">ğŸ“… Establish a Daily Routine</button>
          <button onclick="toggleGoal(this, 'Minimize Stress & Simplify Life')">ğŸŒ¿ Minimize Stress & Simplify Life</button>
          <button onclick="toggleGoal(this, 'Grow Spiritually or Philosophically')">ğŸ•Šï¸ Grow Spiritually or Philosophically</button>
          <button onclick="toggleGoal(this, 'Make a Big Life Change')">ğŸ”„ Make a Big Life Change</button>
       </div>
        <input type="text" id="customGoalInput" placeholder="Write your own goal..." style="margin-top: 1rem;" />
        <button style="margin-top: 0.5rem;" onclick="addCustomGoal()">â• Add Custom Goal</button>
        <br />
        <button id="toStep2Btn" style="display: none; margin-top: 1rem;" onclick="goToStep2()">Next</button>
      </div>

     <div id="quiz-step-2" style="display: none;">
        <div id="motivation-buttons" style="display: flex; flex-direction: column; gap: 0.5rem;">
          <button onclick="toggleMotivation(this, 'Tracking my progress visually')">ğŸ” Tracking my progress visually</button>
          <button onclick="toggleMotivation(this, 'Accountability from others')">ğŸ¤ Accountability from others</button>
          <button onclick="toggleMotivation(this, 'Clear rewards or milestones')">ğŸ¯ Clear rewards or milestones</button>
          <button onclick="toggleMotivation(this, 'Visualizing success')">ğŸŒŸ Visualizing success</button>
          <button onclick="toggleMotivation(this, 'Encouragement and affirmations')">ğŸ’¬ Encouragement and affirmations</button>
          <button onclick="toggleMotivation(this, 'Building habits into my routine')">ğŸ§˜â€â™€ï¸ Building habits into my routine</button>
          <button onclick="toggleMotivation(this, 'Still figuring it out')">ğŸ¤· I havenâ€™t figured it out yet</button>
        </div>

        <input type="text" id="customMotivationInput" placeholder="Add your own motivation..." style="margin-top: 1rem;" />
        <button style="margin-top: 0.5rem;" onclick="addCustomMotivation()">â• Add Custom Motivation</button>
        <br />
        <div class="button-row">
          <button class="button-back-link" onclick="backToStep1()">â¬…ï¸ Back</button>
          <button id="toShortTermBtn" class="button-primary" style="display: none;" onclick="goToShortTerm()">Next â¡ï¸</button>
        </div>


      </div>


      <br />
      <div style="text-align: center; margin-top: 2rem;">
        <button id="startBtn" style="display: none;" onclick="startJourney()">Start Your Journey</button>
      </div>
    </section>
   <section id="dashboard" style="display: none;">
  
<h2>Welcome back! You're doing amazing today ğŸ’ª</h2>
<h3 id="today-title" style="margin-top: -1rem; font-weight: normal;"></h3>
<div id="dashboard-cards" style="display: flex; flex-wrap: wrap; gap: 2rem; justify-content: center; margin-top: 2rem;">

  <div class="card" data-card-id="goals">
    ğŸ¯ <h3>Long-Term Goals</h3>
    <ul id="goal-list"></ul>
  </div>

  <!-- Motivation Corner -->
<div class="card" data-card-id="motivation-corner" style="flex: 1 1 300px; text-align: center;">
  <div class="flex justify-center mb-4">
    ğŸ”¥ <h3 class="ml-2">Motivation Corner</h3>
  </div>
  <p id="quote" class="italic mb-4" style="font-size: 1.2rem;"></p>
  <p id="author" class="text-sm mb-4" style="color: gray;"></p>
  <div class="text-4xl mb-4">âœ¨</div>
  <button class="btn" onclick="refreshQuote()">Refresh Quote</button>
</div>

  <div class="card" data-card-id="motivation">
    ğŸ”¥ <h3>Your Motivation Styles!</h3>
    <ul id="motivation-list" style="list-style: none; padding-left: 0;"></ul>
  </div>


  <div class="card" data-card-id="today">
  âœ… <h3>Today's Habits</h3>

  <div class="flex justify-between mb-2">
    <button class="btn-small" id="show-input">â•</button>
  </div>

  <div id="input-area" class="flex gap-2 mb-2" style="display:none;">
    <input type="text" id="new-habit" class="input" placeholder="New habit name" />
    <button class="btn-small" id="add-habit">Add</button>
  </div>

  <ul id="habit-list"></ul>
</div>


  <div class="card" data-card-id="habitbot" onclick="openHabitbotModal()" style="cursor:pointer;">
  ğŸ¤– <h3>HabitBot Chat</h3>
  <p>Click to open HabitBot!</p>
</div>
  <div class="card" data-card-id="socials" style="max-width: 360px;">
    ğŸ“¢ <h3>Social Feed Preview</h3>
    <div id="social-preview" style="max-height: 150px; overflow-y: auto; font-size: 0.9rem;">
      <!-- JS will inject previews here -->
    </div>
    <div style="text-align: center; margin-top: 1rem;">
      <a href="social.html"><button class="btn-small">Open Full Feed â†’</button></a>
    </div>
  </div>



  <div class="card" data-card-id="progress">
  ğŸ“… <h3>Weekly Progress</h3>
  <p id="streak" class="text-sm mb-2" style="margin-top: 1rem;"></p>
  <div class="bg-white rounded-md p-2 shadow-inner">
    <p id="streak" class="text-sm mb-2" style="margin-bottom: 1rem;"></p>
    <table class="w-full text-xs text-center calendar">
      <thead>
        <tr>
          <th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th>
        </tr>
      </thead>
      <tbody id="calendar-body"></tbody>
    </table>
  </div>
</div>

</div>




   


    <!-- ğŸŒŸ Welcome Popup -->
    <div id="welcomePopup" style="display: none;" class="fade-in">
      <div style="
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      ">
        <div style="
          background: #f9f7f2;
          padding: 2rem 3rem;
          border-radius: 20px;
          box-shadow: 0 10px 25px rgba(0,0,0,0.1);
          text-align: center;
          max-width: 90%;
          font-family: 'Nunito', sans-serif;
        ">
          <h2 id="popupGreeting" style="color: #4a4a40;">Hi there!</h2>
          <p style="color: #6e6b5e;">Weâ€™re so glad youâ€™re here. Letâ€™s build something great together âœ¨</p>
          <button onclick="closeWelcome()" style="
            margin-top: 1.5rem;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            background: #aacbb0;
            color: #2e3d32;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
          ">Letâ€™s go!</button>

        </div>
      </div>
    </div>
  <!-- ğŸŒŸ Logout Confirmation Popup -->
<div id="logoutPopup" style="display: none;" class="fade-in">
  <div style="
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  ">
    <div style="
      background: #f9f7f2;
      padding: 2rem 3rem;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      text-align: center;
      max-width: 90%;
      font-family: 'Satoshi', sans-serif;
    ">
      <h2 style="color: #4a4a40;">Are you sure?</h2>
      <p style="color: #6e6b5e; margin-bottom: 1.5rem;">Youâ€™re about to log out of Habit Harmony ğŸŒ±</p>
      <div style="display: flex; gap: 1rem; justify-content: center;">
        <button onclick="confirmLogout()" class="btn">Yes, Log Out</button>
        <button onclick="closeLogoutPopup()" class="btn" style="background: #ccc; color: #333;">Cancel</button>
      </div>
    </div>
  </div>
</div>
<div style="margin-top: 2rem;">
  <button class="btn-small" onclick="debugDashboardCheck()">ğŸ§ª Debug Dashboard Visibility</button>
</div>

  </main>

  <script defer>
    function validatePasswordRules(password) {
      document.getElementById('rule-length').textContent = password.length >= 8 ? 'âœ… 8+ characters' : 'âŒ 8+ characters';
      document.getElementById('rule-uppercase').textContent = /[A-Z]/.test(password) ? 'âœ… 1 uppercase letter' : 'âŒ 1 uppercase letter';
      document.getElementById('rule-number').textContent = /\d/.test(password) ? 'âœ… 1 number' : 'âŒ 1 number';
    }
  // âœ… SPEECH TO TEXT + HABITBOT SUGGESTIONS + GAS METER MODULES


function startSpeechToText() {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = 'en-US';
  recognition.interimResults = false;

  recognition.onstart = () => showToast("ğŸ¤ Listening...", "info");

  recognition.onerror = () => showToast("Mic error or permission denied", "error");

  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    const input = document.getElementById("habitbot-input") || document.getElementById("habitbot-dashboard-input");
    if (input) input.value = transcript;
  };

  recognition.start();
}

function injectSpeechButton() {
  const inputBox = document.getElementById("habitbot-input") || document.getElementById("habitbot-dashboard-input");
  if (!document.getElementById("speech-btn")) {
    const btn = document.createElement("button");
    btn.innerText = "ğŸ™ï¸ Speak";
    btn.className = "btn-small";
    btn.id = "speech-btn";
    btn.onclick = startSpeechToText;
    inputBox.parentNode.insertBefore(btn, inputBox.nextSibling);
  }
}

function renderGasMeters() {
  const gasContainer = document.createElement("div");
  gasContainer.className = "card";
  gasContainer.innerHTML = `<h3>â›½ Goal Progress</h3>`;

  selectedGoals.forEach(goal => {
    const progress = Math.floor(Math.random() * 100); // You can replace this later with real logic
    const block = document.createElement("div");
    block.style.marginBottom = "1rem";
    block.innerHTML = `
      <p>${goal}</p>
      <div style="width: 100%; height: 12px; background: #eee; border-radius: 6px; overflow: hidden;">
        <div style="width: ${progress}%; height: 100%; background: #7c3aed;"></div>
      </div>
    `;
    gasContainer.appendChild(block);
  });

  document.getElementById("dashboard-cards").appendChild(gasContainer);
}

  async function sendHabitBotMessage() {
  const input =
    document.getElementById("habitbot-input") ||
    document.getElementById("habitbot-dashboard-input");

  const responseDiv = document.getElementById("habitbot-response");
  if (!input || !input.value.trim()) {
    showToast("Please type a message first!", "error");
    return;
  }

  const userMessage = input.value.trim();
  input.value = '';
  const container = document.createElement("div");
    container.innerHTML = `
      <p style="margin-bottom: 0.5rem;">"${fullText}"</p>
      <div style="display: flex; gap: 8px; justify-content: center; margin-top: 1rem;">
        <button class="btn-small" id="acceptSuggestion">âœ… Accept</button>
        <button class="btn-small" id="rejectSuggestion">âŒ Reject</button>
      </div>
    `;

responseDiv.innerHTML = '';
responseDiv.appendChild(container);

  
  document.getElementById("rejectSuggestion").onclick = () => {
    responseDiv.innerHTML = `<p style="color: gray;">Suggestion dismissed.</p>`;
  };


    `
      <p style="margin-bottom: 0.5rem;">"${fullText}"</p>
      <div style="display: flex; gap: 8px; justify-content: center; margin-top: 1rem;">
        <button class="btn-small" id="acceptSuggestion">âœ… Accept</button>
        <button class="btn-small" id="rejectSuggestion">âŒ Reject</button>
      </div>
    `;
    responseDiv.innerHTML = '';
    responseDiv.appendChild(container);

    document.getElementById("acceptSuggestion").onclick = () => {
      if (selectedShortTermGoals.length >= 3) {
        showToast("You already have 3 short-term goals.", "error");
        return;
      }
      const clean = fullText.replace(/"/g, "").trim();
      selectedShortTermGoals.push(clean);
      localStorage.setItem(`shortterm_${userName}`, JSON.stringify(selectedShortTermGoals));
      renderHabits();
      showToast("Habit added to your short-term goals!", "success");
    };

    document.getElementById("rejectSuggestion").onclick = () => {
      responseDiv.innerHTML = `<p style="color: gray;">Suggestion dismissed.</p>`;
    };

    const response = await fetch('https://3796630f-a725-4b25-8ff8-8cdd75c3da82-00-w6gk5ernoe72.spock.replit.dev/habitbot-chat', {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message: userMessage,
        goals: selectedGoals,
        motivations: selectedMotivations
      })

    });

    const serverData = await response.json();
    const fullText = serverData.reply || "Sorry, HabitBot had trouble responding.";
    `
      <p style="margin-bottom: 0.5rem;">"${fullText}"</p>

    responseDiv.innerHTML = '';
    let idx = 0;

    const typing = setInterval(() => {
      if (idx < fullText.length) {
        const char = fullText.charAt(idx);
        responseDiv.innerHTML += char === '\n' ? '<br>' : char;
        idx++;
      } else {
        clearInterval(typing);
      }
    }, 30);

  } catch (error) {
    console.error(error);
    responseDiv.innerText = "HabitBot couldn't reply right now. Try again later!";
  }
}
async function breakDownGoal(goalName) {
  const responseDiv = document.getElementById("habitbot-response");
  responseDiv.innerHTML = '<div class="spinner"></div>';

  try {
    const response = await fetch('https://3796630f-a725-4b25-8ff8-8cdd75c3da82-00-w6gk5ernoe72.spock.replit.dev/habitbot-chat', {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message: `Can you break down this habit into small actionable steps: ${goalName}?`,
        goals: selectedGoals,
        motivations: selectedMotivations
   
    });

    const data = await response.json();
    const reply = data.reply || "Sorry, couldn't break it down right now.";
    responseDiv.innerHTML = reply;

  } catch (err) {
    responseDiv.innerHTML = "Error contacting GPT.";
    console.error(err);
  }
}



    function togglePassword(id) {
      const field = document.getElementById(id);
      if (field.type === "password") {
        field.type = "text";
      } else {
        field.type = "password";
      }
    }
    function detectCapsLock(event, warningId) {
      const caps = event.getModifierState && event.getModifierState('CapsLock');
      document.getElementById(warningId).style.display = caps ? 'block' : 'none';
    }
    async function fetchWithTimeout(resource, options = {}) {
      const { timeout = 5000 } = options;
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), timeout);
      const response = await fetch(resource, {
        ...options,
        signal: controller.signal
      });
      clearTimeout(id);
      return response;
    }

   async function refreshQuote() {
  const quoteElement = document.getElementById('quote');
  const authorElement = document.getElementById('author');

  // Show spinner while loading
  quoteElement.innerHTML = '<div class="spinner"></div>';
  authorElement.textContent = "";

  try {
    const response = await fetchWithTimeout("https://3796630f-a725-4b25-8ff8-8cdd75c3da82-00-w6gk5ernoe72.spock.replit.dev/generate-quote", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ goals: selectedGoals }),
      timeout: 5000
    });

    const data = await response.json();

    if (data.quote) {
      // Split quote and author if possible
      const [quoteText, authorName] = data.quote.split("â€”").map(str => str.trim());

      quoteElement.textContent = `"${quoteText}"`;
      authorElement.textContent = authorName ? `â€” ${authorName}` : "";
    } else {
      throw new Error("No quote found");
    }
  } catch (error) {
    console.error("Failed to fetch real quote, using fallback.", error);
    updateQuote(); // fallback quotes
  }
}

    


    function handleReset() {
      const btn = document.getElementById("resetActionBtn");
      const name = document.getElementById("reset-name").value.trim().toLowerCase();
      const answer = document.getElementById("reset-answer").value.trim().toLowerCase();
      const newPassword = document.getElementById("new-password").value;
    
      // Step 1: Lookup user and show question
      if (!resetUserMatch) {
        const users = getUserDB();
        resetUserMatch = users.find(user => user.name.toLowerCase() === name); // ğŸ”¥ Add this line
        
        if (!resetUserMatch) {
          showToast("User not found.", "error");
          return;
        }
      
        document.getElementById("securityQuestionDisplay").textContent = resetUserMatch.question;
        document.getElementById("reset-answer").style.display = "block";
        document.getElementById("new-password").style.display = "block";
        btn.textContent = "Reset Password";
        return;
      }


    
      // Step 2: Validate answer and reset password
      if (hashPassword(answer) !== resetUserMatch.answer) {
        showToast("Incorrect answer to the security question.", "error");
        return;
      }
    
      if (!newPassword) {
        showToast("Please enter a new password.", "error");
        return;
      }
    
      const users = getUserDB();
      const userIndex = users.findIndex(u => u.name === resetUserMatch.name);
      users[userIndex].password = hashPassword(newPassword);
      saveUserDB(users);
    
      showToast("Password successfully reset! Please log in.", "info");
      resetUserMatch = null;
      document.getElementById("resetActionBtn").textContent = "Next";
      document.getElementById("reset-answer").style.display = "none";
      document.getElementById("new-password").style.display = "none";
      document.getElementById("securityQuestionDisplay").textContent = "";
      document.getElementById("reset-name").value = "";
      document.getElementById("reset-answer").value = "";
      document.getElementById("new-password").value = "";
    
      backToLogin();
    }

    let resetUserMatch = null;

    function showPasswordReset() {
      document.getElementById("login-section").style.display = "none";
      document.getElementById("reset-section").style.display = "block";
    }
    
    function backToLogin() {
      document.getElementById("reset-section").style.display = "none";
      fadeInAndShow("login-section");
    }

    function showLogin() {
      document.getElementById("auth-section").style.display = "none";
      fadeInAndShow("login-section");
    }
    
    function showSignup() {
      document.getElementById("login-section").style.display = "none";
      document.getElementById("auth-section").style.display = "block";
    }
    
    function loginUser() {
      const loginName = document.getElementById("login-name").value.trim();
      const loginPassword = document.getElementById("login-password").value;
    
      if (!loginName || !loginPassword) {
        showToast("Please enter both username and password.", "error");
        return;
      }
    
      const users = getUserDB();
      const match = users.find(user => 
        user.name.toLowerCase() === loginName.toLowerCase() &&
        user.password === hashPassword(loginPassword)
      );
    
      if (!match) {
        showToast("Invalid username or password.", "error");
        return;
      }
    
      userName = loginName;
      selectedGoals = JSON.parse(localStorage.getItem(`goals_${userName}`) || "[]");

      if (userName.toLowerCase() === "aiyanna") {
        const clearButton = document.createElement("button");
        clearButton.innerText = "ğŸ—‘ï¸ Clear All Users";
        clearButton.onclick = clearAllUsers;
        clearButton.style.width = "100%";
        clearButton.style.padding = "10px";
        clearButton.style.background = "none";
        clearButton.style.border = "none";
        clearButton.style.textAlign = "left";
        clearButton.style.cursor = "pointer";
        document.getElementById("menuDropdown").appendChild(clearButton);
      }

    
      document.getElementById("popupGreeting").innerText = `Welcome back, ${userName}!`;
      document.getElementById("welcomePopup").style.display = "block";
      document.getElementById("menuButton").style.display = "block";

    
      confetti({
        particleCount: 100,
        spread: 80,
        origin: { y: 0.6 }
      });
      setTimeout(() => {
      document.getElementById("welcomePopup").style.display = "none";
      document.getElementById("auth-section").style.display = "none";
        
      console.log("[DEBUG] loginUser(): userName =", userName);
      console.log("[DEBUG] localStorage.getItem(`goals_${userName}`) =", localStorage.getItem(`goals_${userName}`));
      console.log("[DEBUG] localStorage keys =", Object.keys(localStorage));

      const goalKey = `goals_${userName}`;
      const goalData = localStorage.getItem(goalKey);
      console.log("[DEBUG] loginUser() â†’ key:", goalKey);
      console.log("[DEBUG] loginUser() â†’ value:", goalData);
      console.log("[DEBUG] loginUser() â†’ all localStorage keys:", Object.keys(localStorage));
      
      if (goalData) {
        console.log("[DEBUG] Showing dashboard for user:", userName);
        document.getElementById("dashboard").style.display = "block";
        document.getElementById("dashboard").classList.add("fade-in");
        injectSpeechButton();
        renderGasMeters();
        document.getElementById("userTitle").innerText = `${userName}'s habits`;
        document.getElementById("userTitle").style.display = "block";
      } else {
        console.log("[DEBUG] Showing onboarding. No goals found for user:", userName);
        document.getElementById("onboarding").style.display = "block";
        document.getElementById("onboarding").classList.add("fade-in");
      }

      
      document.getElementById("username").value = userName;
      document.getElementById("menuButton").style.display = "block";
    }, 1500);


      localStorage.setItem("hasOnboarded_" + userName, "true");
      localStorage.setItem("lastUser", userName);
      localStorage.setItem("currentUser", userName);


    
     setTimeout(() => {
      document.getElementById("welcomePopup").style.display = "none";
      document.getElementById("auth-section").style.display = "none";
      document.getElementById("login-section").style.display = "none";
    
      const goalKey = `goals_${userName}`;
      const goalData = localStorage.getItem(goalKey);
      console.log("[DEBUG] loginUser() â†’ key:", goalKey);
      console.log("[DEBUG] loginUser() â†’ value:", goalData);
      console.log("[DEBUG] loginUser() â†’ all localStorage keys:", Object.keys(localStorage));
      
      if (goalData) {
        console.log("[DEBUG] Showing dashboard for user:", userName);
        document.getElementById("dashboard").style.display = "block";
        document.getElementById("dashboard").classList.add("fade-in");
        injectSpeechButton();
        renderGasMeters();
        document.getElementById("userTitle").innerText = `${userName}'s habits`;
        document.getElementById("userTitle").style.display = "block";
      } else {
        console.log("[DEBUG] Showing onboarding. No goals found for user:", userName);
        document.getElementById("onboarding").style.display = "block";
        document.getElementById("onboarding").classList.add("fade-in");
      }

    
      document.getElementById("username").value = userName;
      document.getElementById("menuButton").style.display = "block";
    }, 1500);

    }
    
        


    let selectedLongTermGoal = "";
    function hashPassword(password) {
      return btoa(password); // Just for demo â€“ not secure
    }
    
    function getUserDB() {
      return JSON.parse(localStorage.getItem("habitUsers") || "[]");
    }
    function fadeOutAndHide(id) {
      const el = document.getElementById(id);
      el.classList.add("fade-out");
      setTimeout(() => {
        el.style.display = "none";
        el.classList.remove("fade-out");
      }, 500);
    }
    
    function fadeInAndShow(id) {
      const el = document.getElementById(id);
      el.style.display = "block";
      el.classList.add("fade-in");
    }
    
    function saveUserDB(users) {
      localStorage.setItem("habitUsers", JSON.stringify(users));
    }

    let selectedShortTermGoal = "";
    let userName = "";
    let selectedShortTermGoals = [];
    let selectedGoals = [];

    const shortTermGoalsMap = {
      "Improve Physical Health": [
        "ğŸš¶ Walk 7,000+ steps today",
        "ğŸ¥¦ Eat a veggie with every meal",
        "ğŸ’§ Drink 8 cups of water",
        "ğŸ‹ï¸ Do a 20-minute workout",
        "ğŸ§˜ Stretch for 10 minutes"
      ],
      "Boost Mental Well-Being": [
        "ğŸ““ Journal for 5 minutes tonight",
        "ğŸ§˜ Meditate for 10 minutes",
        "ğŸŒ… Go for a mindful morning walk",
        "ğŸ“µ Unplug from screens 1 hour before bed",
        "ğŸ§ Listen to calming music during lunch"
      ],
      "Advance Career or Education": [
        "ğŸ“š Study or read for 30 minutes",
        "ğŸ“… Plan your week in Google Calendar",
        "ğŸ“ Apply to one opportunity",
        "ğŸ‘¨â€ğŸ« Attend a virtual webinar or event",
        "âœ… Check off one thing on your to-do list"
      ],
      "Build Financial Stability": [
        "ğŸ’¸ Track todayâ€™s spending",
        "ğŸ¦ Transfer $5 to savings",
        "ğŸ§¾ Review 3 recent transactions",
        "ğŸ“ˆ Update your budget or spreadsheet",
        "ğŸ›ï¸ Skip a non-essential purchase today"
      ],
      "Strengthen Relationships": [
        "ğŸ“± Text or call a friend/family member",
        "ğŸ‘¥ Schedule a hangout",
        "ğŸ’Œ Send a thoughtful message",
        "ğŸ§  Remember a friendâ€™s upcoming event",
        "ğŸ Plan a small surprise for someone"
      ],
      "Enhance Creativity or Hobbies": [
        "ğŸ¨ Create for 20 minutes",
        "ğŸ“· Take a creative photo today",
        "ğŸ“ Write something short (poem, journal)",
        "ğŸ§ Listen to an inspiring podcast",
        "ğŸ“š Read or watch something for inspiration"
      ],
      "Establish a Daily Routine": [
        "ğŸ›ï¸ Wake up at a consistent time",
        "ğŸ“… Fill out your daily plan",
        "ğŸ½ï¸ Eat meals at regular times",
        "ğŸ§¼ Do one routine chore (dishes, laundry)",
        "ğŸ” Repeat one habit from yesterday"
      ],
      "Minimize Stress & Simplify Life": [
        "ğŸ—‘ï¸ Declutter one space (desk, bag, folder)",
        "ğŸ§˜ Breathe deeply for 3 minutes",
        "ğŸ“µ Turn off notifications for 1 hour",
        "ğŸ“ Do a 5-minute brain dump",
        "ğŸ•°ï¸ Time-block your next 2 hours"
      ],
      "Grow Spiritually or Philosophically": [
        "ğŸ“– Read a page of a spiritual or wisdom text",
        "ğŸ™ Reflect on 1 thing you're grateful for",
        "ğŸŒŒ Watch the sunset or stargaze",
        "ğŸ§˜ Meditate with intention (even 5 min)",
        "ğŸª Ask yourself a deep question & journal"
      ],
      "Make a Big Life Change": [
        "ğŸ§­ Write out your ideal day 1 year from now",
        "ğŸ“‹ List 3 next steps for your goal",
        "ğŸ“… Schedule time to work on a transition",
        "ğŸ“ Call someone whoâ€™s done it before",
        "ğŸ§¼ Let go of one thing thatâ€™s holding you back"
      ]
    };

    function toggleGoal(button, goal) {
      const index = selectedGoals.indexOf(goal);
      if (index > -1) {
        selectedGoals.splice(index, 1);
        button.classList.remove("selected");
      } else {
        if (selectedGoals.length >= 3) {
          showToast("You can only choose up to 3 goals.", "error");
          return;
        }
        selectedGoals.push(goal);
        button.classList.add("selected");
      }
  
    
      
      document.getElementById("toStep2Btn").style.display = selectedGoals.length > 0 ? "inline-block" : "none";
    }

    function addCustomGoal() {
      const input = document.getElementById("customGoalInput");
      const goal = input.value.trim();
      if (!goal) {
        showToast("Please enter a custom goal.", "error");
        return;
      }
      if (selectedGoals.includes(goal)) {
        showToast("You already added this goal.", "error");
        return;
      }
      if (selectedGoals.length >= 3) {
        showToast("You can only choose up to 3 goals.", "error");
        return;
      }
    
      const newBtn = document.createElement("button");
      newBtn.textContent = `âœ¨ ${goal}`;
      newBtn.classList.add("selected");
      newBtn.onclick = () => {
        selectedGoals = selectedGoals.filter(g => g !== goal);
        newBtn.remove();
        document.getElementById("toStep2Btn").style.display = selectedGoals.length > 0 ? "inline-block" : "none";
      };
    
      document.getElementById("goal-buttons").appendChild(newBtn);
      selectedGoals.push(goal);
      input.value = "";
    
      document.getElementById("toStep2Btn").style.display = "inline-block";
    }
  
    let selectedMotivations = [];
    

function toggleMotivation(button, motivation) {
  const index = selectedMotivations.indexOf(motivation);

  if (index > -1) {
    selectedMotivations.splice(index, 1);
    button.classList.remove("selected");
  } else {
    if (selectedMotivations.length >= 2) {
      showToast("Please pick up to 2 motivation styles.", "error");
      return;
    }
    selectedMotivations.push(motivation);
    button.classList.add("selected");
  }

  document.getElementById("toShortTermBtn").style.display = selectedMotivations.length > 0 ? "inline-block" : "none";
}

function toggleShortTerm(button, goal) {
  const index = selectedShortTermGoals.indexOf(goal);

  if (index > -1) {
    selectedShortTermGoals.splice(index, 1);
    button.classList.remove("selected");
  } else {
    if (selectedShortTermGoals.length >= 3) {
      showToast("You can only pick up to 3 short-term habits.", "error");
      return;
    }
    selectedShortTermGoals.push(goal);
    button.classList.add("selected");
  }

  document.getElementById("toStartBtn").style.display = selectedShortTermGoals.length > 0 ? "inline-block" : "none";
}



function addCustomMotivation() {
  const input = document.getElementById("customMotivationInput");
  const motivation = input.value.trim();
  if (!motivation) {
    showToast("Please enter a custom motivation.", "error");
    return;
  }
  if (selectedMotivations.includes(motivation)) {
    showToast("You already added this motivation.", "error");
    return;
  }
  if (selectedMotivations.length >= 2) {
    	showToast("Please pick up to 2 motivation styles", "error");
    return;
  }

  const newBtn = document.createElement("button");
  newBtn.textContent = `âœ¨ ${motivation}`;
  newBtn.classList.add("selected");
  newBtn.onclick = () => {
    selectedMotivations = selectedMotivations.filter(m => m !== motivation);
    newBtn.remove();
    document.getElementById("toShortTermBtn").style.display = selectedMotivations.length > 0 ? "inline-block" : "none";
  };

  document.getElementById("motivation-buttons").appendChild(newBtn);
  selectedMotivations.push(motivation);
  input.value = "";

  document.getElementById("toShortTermBtn").style.display = "inline-block";
}
    
async function getShortTermGoalsFromGPT(longTermGoals) {
  const response = await fetch("https://3796630f-a725-4b25-8ff8-8cdd75c3da82-00-w6gk5ernoe72.spock.replit.dev/generate-goals", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ goals: longTermGoals })
  });

  try {
    const raw = await response.text();
    console.log("GPT RAW RESPONSE:", raw);
    const data = JSON.parse(raw);
  // âœ… SAFELY CHECK if choices exist INSIDE try
  if (!data.choices || !data.choices[0] || !data.choices[0].message) {
    throw new Error("Invalid GPT response.");
  }

  const text = data.choices[0].message.content;
  return text.split("\n").filter(line => line.trim()).slice(0, 3);

} catch (err) {
  console.error("Error parsing or using GPT response:", err);
  throw err; // re-throw so calling function knows it failed
}
}

async function goToShortTerm() {
  updateProgress(85);
  document.getElementById("quiz-step-2").style.display = "none";

  const shortTermSection = document.createElement("div");
  shortTermSection.id = "quiz-step-3";
  shortTermSection.innerHTML = `<p>Loading personalized short-term goals...</p>`;
  document.getElementById("onboarding").appendChild(shortTermSection);

  let gptSuggestions = [];

  try {
    gptSuggestions = await getShortTermGoalsFromGPT(selectedGoals);
  } catch (error) {
    console.error("Error fetching GPT goals:", error);
    showToast("Could not load personalized goals right now â€” showing suggested habits instead!", "info");


    // ğŸ”¥ Fallback: grab default goals manually from your `shortTermGoalsMap`
    selectedGoals.forEach(goal => {
      if (shortTermGoalsMap[goal]) {
        gptSuggestions = gptSuggestions.concat(shortTermGoalsMap[goal].slice(0, 2)); // pick 2 from each category
      }
    });

    // If nothing selected, just have some generic habits ready
    if (gptSuggestions.length === 0) {
      gptSuggestions = [
        "ğŸš¶ Walk for 10 minutes",
        "ğŸ“ Write down one goal for today",
        "ğŸ›ï¸ Go to bed 30 minutes earlier"
      ];
    }

    // Remove duplicates
    gptSuggestions = [...new Set(gptSuggestions)].slice(0, 5);
  }
  
  // CLEAN GPT suggestions to remove "1.", "2.", etc.
gptSuggestions = gptSuggestions.map(g => g.replace(/^\d+\.\s*/, '').trim());


shortTermSection.innerHTML = `
  <p>Pick up to <strong>3 short-term habits</strong> to work on this week:</p>

  <div style="margin-bottom: 2rem;">
    <div id="shortterm-buttons" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
      ${gptSuggestions.map(goal => `<button onclick="toggleShortTerm(this, '${goal.replace(/'/g, "\\'")}')">${goal}</button>`).join('')}
    </div>

    <input type="text" id="customShortTermInput" placeholder="Or write your own..." style="margin-top: 1rem;" />
    <button style="margin-top: 0.5rem;" onclick="addCustomShortTermGoal()">â• Add Custom Goal</button>
  </div>

  <div class="button-row">
    <button class="button-back-link" onclick="backToStep2()">â¬…ï¸ Back</button>
    <button id="toStartBtn" class="button-primary" style="display: none;" onclick="prepareStart()">Next â¡ï¸</button>
  </div>
`;

}



    
    function goToStep2() {
      updateProgress(66);
      document.getElementById("quiz-step-1").style.display = "none";
      document.getElementById("quiz-step-2").style.display = "block";
      document.getElementById("onboarding-heading").innerText = "Let's personalize your journey!";
      document.getElementById("onboarding-subheading").innerText = "Which methods help you stick with your habits?";

    }
    function backToStep1() {
      updateProgress(33); // Step 1 progress
      document.getElementById("quiz-step-2").style.display = "none";
      document.getElementById("quiz-step-1").style.display = "block";
      document.getElementById("onboarding-heading").innerText = "Hi there!";
      document.getElementById("onboarding-subheading").innerText = "Letâ€™s make a plan just for you. Whatâ€™s something you want to build into your life?";
    }
    
    function backToStep2() {
      updateProgress(66); // Step 2 progress
      document.getElementById("quiz-step-3").style.display = "none";
      document.getElementById("quiz-step-2").style.display = "block";
      document.getElementById("onboarding-heading").innerText = "Let's personalize your journey!";
      document.getElementById("onboarding-subheading").innerText = "Which methods help you stick with your habits?";
    }


    function completeSignup() {
      const nameInput = document.getElementById("auth-name").value.trim();
      const password = document.getElementById("auth-password").value;
      const confirmPassword = document.getElementById("auth-confirm-password").value;
      
      if (!nameInput || !password || !confirmPassword) {
        showToast("Please complete all fields", "error");
        return;
      }
      
      if (password !== confirmPassword) {
        showToast("Passwords do not match.", "error");
        return;
      }
    
      const users = getUserDB();
      const userExists = users.some(user => user.name.toLowerCase() === nameInput.toLowerCase());
    
      if (userExists) {
        showToast("Username already taken.", "error");
        return;
      }
    
      const question = document.getElementById("security-question").value.trim();
      const answer = document.getElementById("security-answer").value.trim();
      
      if (question === "" || !answer) {
        showToast("Please select a security question and provide an answer.", "error");
        return;
      }
    
      
      users.push({
        name: nameInput,
        password: hashPassword(password),
        question,
        answer: hashPassword(answer.toLowerCase())
      });
      
    
      saveUserDB(users);
    
      userName = nameInput;
      if (userName === "Aiyanna") {
        const devTools = document.createElement("div");
        devTools.innerHTML = `
          <h4>Developer Controls</h4>
          <button onclick="clearAllUsers()">ğŸ—‘ï¸ Clear All Users</button>
        `;
        document.getElementById("dashboard").appendChild(devTools);
      }
      document.getElementById("popupGreeting").innerText = `Hi, ${userName}!`;
      document.getElementById("welcomePopup").style.display = "block";
      document.getElementById("menuButton").style.display = "block";

    
      confetti({
        particleCount: 100,
        spread: 80,
        origin: { y: 0.6 }
      });

      setTimeout(() => {
        closeWelcome();
      }, 1500); // 1.5 second delay after confetti

    }


    
    function closeWelcome() {
      document.getElementById("welcomePopup").classList.add("fade-out");
      setTimeout(() => {
        document.getElementById("welcomePopup").style.display = "none";
        document.getElementById("auth-section").style.display = "none";
        document.getElementById("login-section").style.display = "none";
        document.getElementById("onboarding").style.display = "block";
        document.getElementById("onboarding").classList.add("fade-in");
        document.getElementById("username").value = userName;
      }, 500);
    }

    function updateProgress(percent) {
      document.getElementById("progressFill").style.width = percent + "%";
    }

    function setLongTermGoal(goal) {
      selectedLongTermGoal = goal;
      updateProgress(66);
      
      document.getElementById("customGoal").style.display = "block";
      document.getElementById("quiz-step-1").style.display = "none";
      document.getElementById("quiz-step-2").style.display = "block";
    }

    function setShortTermGoal(goal) {
      selectedShortTermGoal = goal;
      updateProgress(100);
      document.getElementById("quiz-step-2").style.display = "none";
      document.getElementById("startBtn").style.display = "inline-block";
    }

    function addCustomShortTermGoal() {
      const input = document.getElementById("customShortTermInput");
      const goal = input.value.trim();
      if (!goal) {
        showToast("Please enter a short-term goal.", "error");
        return;
      }
      if (selectedShortTermGoals.includes(goal)) {
        showToast("You already added this goal.", "error");
        return;
      }
      if (selectedShortTermGoals.length >= 3) {
        showToast("You can only pick up to 3 short-term habits.", "error");
        return;
      }
    
      const newBtn = document.createElement("button");
      newBtn.textContent = `âœ¨ ${goal}`;
      newBtn.onclick = function() {
        toggleShortTerm(newBtn, goal);
      };
      document.getElementById("shortterm-buttons").appendChild(newBtn);
      
      // ğŸ’¥ ADD THIS:
      toggleShortTerm(newBtn, goal);
    
      input.value = "";
    }

    
    
        function startJourney() {
          const customGoalElement = document.getElementById("customGoalInput");
          const customGoalInput = customGoalElement ? customGoalElement.value : "";
    
    
          if (!userName || !selectedGoals.length || !selectedShortTermGoals.length) {
            showToast("Please complete all steps!", "error");
            return;
          }

          localStorage.setItem(`goals_${userName}`, JSON.stringify(selectedGoals));
          console.log("[DEBUG] Saving goals to:", `goals_${userName}`, selectedGoals);
          localStorage.setItem(`motivations_${userName}`, JSON.stringify(selectedMotivations));
          localStorage.setItem(`shortterm_${userName}`, JSON.stringify(selectedShortTermGoals));


      document.getElementById("onboarding").classList.add("fade-out");
      setTimeout(() => {
        document.getElementById("onboarding").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
        document.getElementById("dashboard").classList.add("fade-in");
    
      



        const userTitle = document.getElementById("userTitle");
        userTitle.innerText = `${userName}'s habits`;
        userTitle.style.display = "block";
      }, 600);
    }

    function addHabit() {
      const habit = document.getElementById("habitInput").value;
      if (habit) {
        const listItem = document.createElement("li");
        listItem.textContent = habit;
        document.getElementById("habitList").appendChild(listItem);
        document.getElementById("habitInput").value = "";
      }
    }
    function logoutUser() {
      document.getElementById("logoutPopup").style.display = "block";
    }
    
    function confirmLogout() {
      localStorage.removeItem("lastUser");
      localStorage.setItem(`goals_${userName}`, JSON.stringify(selectedGoals));
      localStorage.setItem(`motivations_${userName}`, JSON.stringify(selectedMotivations));
      localStorage.setItem(`shortterm_${userName}`, JSON.stringify(selectedShortTermGoals));

      userName = "";
      selectedGoals = [];
      selectedMotivations = [];
      selectedShortTermGoals = [];
    
      fadeOutAndHide("dashboard");
      document.getElementById("menuButton").style.display = "none";
      document.getElementById("userTitle").style.display = "none";
      fadeInAndShow("login-section");
      document.getElementById("menuDropdown").classList.remove("open");
      document.getElementById("menuDropdown").style.display = "none";
    
      document.getElementById("logoutPopup").style.display = "none";
    
      showToast("You have been logged out!", "info");
    }
    
    function closeLogoutPopup() {
      document.getElementById("logoutPopup").style.display = "none";
    }


    function clearAllUsers() {
      const confirmClear = confirm("Are you sure you want to delete all users? This cannot be undone.");
      if (confirmClear) {
        localStorage.removeItem("habitUsers");
        localStorage.removeItem("lastUser");
    
        // Clear all hasOnboarded_ keys
        Object.keys(localStorage).forEach(key => {
          if (key.startsWith("hasOnboarded_")) {
            localStorage.removeItem(key);
          }
        });
    
        showToast("All user accounts and session data have been cleared.", "info");
        document.getElementById("dashboard").style.display = "none";
        document.getElementById("onboarding").style.display = "block";
        updateProgress(0);

      }
    }

    window.onerror = function (msg, url, line, col, error) {
      showToast("âš ï¸ JS Error: " + msg + " on line " + line, "error");
    };
    // ğŸŒ™ Theme Toggle
        document.getElementById("themeToggle").addEventListener("click", () => {
        document.body.classList.toggle("low-light");
      });

  function prepareStart() {
    if (selectedShortTermGoals.length === 0) {
      showToast("Pick at least one habit to continue!", "error");
      return;
    }
  
    updateProgress(100);
  
    document.getElementById("quiz-step-3").style.display = "none";
    document.getElementById("onboarding-heading").innerText = "You're ready!";
    document.getElementById("onboarding-subheading").innerText = "Review and start your habit journey below:";
    document.getElementById("startBtn").style.display = "inline-block";
  }
  // ğŸ”¥ New toast message system
  function showToast(message, type = "info") {
    const toast = document.createElement("div");
    toast.innerText = message;
    toast.style.position = "fixed";
    toast.style.bottom = "20px";
    toast.style.left = "50%";
    toast.style.transform = "translateX(-50%)";
    toast.style.backgroundColor = type === "error" ? "#f44336" : "#7c3aed";
    toast.style.color = "white";
    toast.style.padding = "1rem 2rem";
    toast.style.borderRadius = "8px";
    toast.style.boxShadow = "0 4px 12px rgba(0,0,0,0.2)";
    toast.style.fontSize = "1rem";
    toast.style.zIndex = 9999;
    toast.style.opacity = 1;
    toast.style.transition = "opacity 0.5s ease-out";
  
    document.body.appendChild(toast);
  
    setTimeout(() => {
      toast.style.opacity = 0;
      setTimeout(() => document.body.removeChild(toast), 500);
    }, 3000); // Disappear after 3s
  }
  function addToGoogleCalendar(goal) {
  const title = encodeURIComponent(goal);
  const url = `https://calendar.google.com/calendar/r/eventedit?text=${title}&details=Added+from+Habit+Harmony!`;
  window.open(url, '_blank');
}
const dashboard = document.getElementById('dashboard-cards');

new Sortable(dashboard, {
  animation: 150,
  onEnd: function () {
    const order = [];
    dashboard.querySelectorAll('.card').forEach(card => {
      order.push(card.getAttribute('data-card-id'));
    });
    localStorage.setItem('dashboardOrder', JSON.stringify(order));

    // ğŸ”¥ ADD this too:
    localStorage.setItem(`goals_${userName}`, JSON.stringify(selectedGoals));
    localStorage.setItem(`motivations_${userName}`, JSON.stringify(selectedMotivations));
    localStorage.setItem(`shortterm_${userName}`, JSON.stringify(selectedShortTermGoals));
  }
});
function openHabitbotModal() {
  document.getElementById('habitbotModal').style.display = 'flex';
}
function closeHabitbotModal() {
  document.getElementById('habitbotModal').style.display = 'none';
}
function resetGoals() {
  const confirmReset = confirm("Are you sure you want to reset all your goals? This cannot be undone.");
  if (confirmReset) {
    localStorage.removeItem(`goals_${userName}`);
    localStorage.removeItem(`motivations_${userName}`);
    localStorage.removeItem(`shortterm_${userName}`);
    showToast("Goals reset. Restarting onboarding...", "info");
    document.getElementById("dashboard").style.display = "none";
    document.getElementById("onboarding").style.display = "block";
    updateProgress(0);
    selectedGoals = [];
    selectedMotivations = [];
    selectedShortTermGoals = [];
    
    document.querySelectorAll('#goal-buttons button').forEach(btn => btn.classList.remove('selected'));
    document.querySelectorAll('#motivation-buttons button').forEach(btn => btn.classList.remove('selected'));
    const custom = document.querySelectorAll('#goal-buttons .selected, #motivation-buttons .selected');
    custom.forEach(btn => btn.remove());
    
    document.getElementById("toStep2Btn").style.display = "none";
    document.getElementById("toShortTermBtn").style.display = "none";
    document.getElementById("toStartBtn").style.display = "none";


  }
}
function debugDashboardCheck() {
  const key = `goals_${userName}`;
  console.log("[DEBUG BUTTON] Checking key:", key, "value:", localStorage.getItem(key));
  if (localStorage.getItem(key)) {
    document.getElementById("dashboard").style.display = "block";
  } else {
    document.getElementById("onboarding").style.display = "block";
  }
}

function renderSocialPreview() {
  const container = document.getElementById("social-preview");
  const posts = JSON.parse(localStorage.getItem("habitPosts") || "[]");

  ""; // clear old previews

  if (posts.length === 0) {
    container.innerHTML = "<p>No posts yet. Start sharing!</p>";
    return;
  }

  const latest = posts.slice(-3).reverse(); // last 3 posts
  latest.forEach(post => {
    const div = document.createElement("div");
    div.style.borderBottom = "1px solid #ddd";
    div.style.padding = "6px 0";
    div.innerHTML = `
      <strong>@${post.username}</strong><br />
      <span style="font-style: italic;">${post.title}</span><br />
      <span>${post.caption.slice(0, 60)}${post.caption.length > 60 ? "..." : ""}</span>
    `;
    container.appendChild(div);
  });
}



  </script>
  <script defer>
let habits = [];
const completedDates = [];
const quotes = [
  { text: "Small habits make a big difference. Keep going!", author: "James Clear" },
  { text: "Progress, not perfection.", author: "Kim Collins" },
  { text: "One day at a time.", author: "Anonymous" },
  { text: "Your future is created by what you do today.", author: "Robert Kiyosaki" },
];

function updateDateTime() {
  const now = new Date();
  const date = now.toLocaleDateString(undefined, { month: 'long', day: 'numeric', year: 'numeric' });
  const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  document.getElementById('datetime').textContent = `${date} â€¢ ${time} â€¢ ${now.getHours() >= 6 && now.getHours() < 18 ? 'ğŸŒ¤ï¸ 72Â°F' : 'ğŸŒ™ 72Â°F'}`;
  document.getElementById('time-icon').textContent = now.getHours() >= 6 && now.getHours() < 18 ? 'ğŸŒ' : 'ğŸŒ™';
}

function renderHabits() {
  const list = document.getElementById('habit-list');
  list.innerHTML = '';
  habits.forEach((habit, idx) => {
    const li = document.createElement('li');
    li.className = 'flex justify-between items-center';
    li.innerHTML = `
      <div class="flex items-center">
        <input type="checkbox" ${habit.completed ? 'checked' : ''} onchange="toggleHabit(${idx})">
        <div class="${habit.completed ? 'text-line' : ''}" style="margin-left: 1rem;">${habit.name}</div>
        <button class="btn-small" onclick="addHabitToGoogleCalendar('${habits[idx].name}')">ğŸ“…</button>
        <button class="btn-small" onclick="breakDownGoal('${habits[idx].name}')">ğŸ”</button>
      </div>
    `;



    list.appendChild(li);
  });
}

function toggleHabit(index) {
  habits[index].completed = !habits[index].completed;
  renderHabits();
}

function deleteHabit(index) {
  habits.splice(index, 1);
  renderHabits();
}
function addHabitToGoogleCalendar(habitName) {
  const title = encodeURIComponent(habitName);
  const url = `https://calendar.google.com/calendar/r/eventedit?text=${title}&details=Added+via+Habit+Harmony`;
  window.open(url, '_blank');
}



const addHabitButton = document.getElementById('add-habit');
if (addHabitButton) {
  addHabitButton.onclick = () => {
    const input = document.getElementById('new-habit');
    if (input.value.trim()) {
      habits.push({ name: input.value.trim(), completed: false });
      input.value = '';
      const inputArea = document.getElementById('input-area');
      if (inputArea) {
        inputArea.style.display = 'none';
      }
      renderHabits();
    }
  };
}

let lastQuoteIndex = -1;
function updateQuote() {
  let newIndex;
  do {
    newIndex = Math.floor(Math.random() * quotes.length);
  } while (newIndex === lastQuoteIndex && quotes.length > 1);
  lastQuoteIndex = newIndex;

  const q = quotes[newIndex];
  document.getElementById('quote').textContent = `"${q.text}"`;
  document.getElementById('author').textContent = `â€“ ${q.author}`;
}




function generateCalendar() {
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth();
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const todayStr = now.toISOString().split('T')[0];
  highlightToday()

  let day = 1;
  const tbody = document.getElementById('calendar-body');
  tbody.innerHTML = '';

  for (let i = 0; i < 6; i++) {
    const row = document.createElement('tr');
    for (let j = 0; j < 7; j++) {
      const cell = document.createElement('td');
      if ((i === 0 && j < firstDay) || day > daysInMonth) {
        cell.textContent = '';
      } else {
        const key = `${year}-${(month + 1).toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}`;
        cell.textContent = day;
        if (key === todayStr) cell.className = 'today';
        else if (completedDates.includes(key)) cell.className = 'completed';
        else cell.className = 'upcoming';
        day++;
      }
      row.appendChild(cell);
    }
    tbody.appendChild(row);
  }
}
// âœ… SPEECH TO TEXT + HABITBOT SUGGESTIONS + GAS METER MODULES

function startSpeechToText() {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = 'en-US';
  recognition.interimResults = false;

  recognition.onstart = () => showToast("ğŸ¤ Listening...", "info");

  recognition.onerror = () => showToast("Mic error or permission denied", "error");

  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    const input = document.getElementById("habitbot-input") || document.getElementById("habitbot-dashboard-input");
    if (input) input.value = transcript;
  };

  recognition.start();
}

function injectSpeechButton() {
  const inputBox = document.getElementById("habitbot-input") || document.getElementById("habitbot-dashboard-input");
  if (!document.getElementById("speech-btn")) {
    const btn = document.createElement("button");
    btn.innerText = "ğŸ™ï¸ Speak";
    btn.className = "btn-small";
    btn.id = "speech-btn";
    btn.onclick = startSpeechToText;
    inputBox.parentNode.insertBefore(btn, inputBox.nextSibling);
  }
}

function renderGasMeters() {
  const gasContainer = document.createElement("div");
  gasContainer.className = "card";
  gasContainer.innerHTML = `<h3>â›½ Goal Progress</h3>`;

  selectedGoals.forEach(goal => {
    const progress = Math.floor(Math.random() * 100); // You can replace this later with real logic
    const block = document.createElement("div");
    block.style.marginBottom = "1rem";
    block.innerHTML = `
      <p>${goal}</p>
      <div style="width: 100%; height: 12px; background: #eee; border-radius: 6px; overflow: hidden;">
        <div style="width: ${progress}%; height: 100%; background: #7c3aed;"></div>
      </div>
    `;
    gasContainer.appendChild(block);
  });

  document.getElementById("dashboard-cards").appendChild(gasContainer);
}


function updateStreak() {
  document.getElementById('streak').textContent = `You're on a ${Math.max(1, completedDates.length)}-day streak!`;
}

updateDateTime();
renderHabits();
updateQuote();
generateCalendar();
updateStreak();

setInterval(updateDateTime, 60000);

const menuButton = document.getElementById("menuButton");
const menuDropdown = document.getElementById("menuDropdown");

menuButton.addEventListener("click", function() {
  if (menuDropdown.classList.contains("open")) {
    menuDropdown.classList.remove("open");
    menuDropdown.style.display = "none";
  } else {
    menuDropdown.classList.add("open");
    menuDropdown.style.display = "block";
  }
});


function highlightToday() {
  const todayElements = document.querySelectorAll('.today');
  todayElements.forEach(el => {
    if (document.body.classList.contains('low-light')) {
      el.style.background = '#a78bfa'; // Lilac
      el.style.color = '#1a1a1a'; // Dark text
    } else {
      el.style.background = '#7c3aed'; // Bright purple
      el.style.color = 'white'; // White text
    }
  });
}
function toggleTheme() {
  document.body.classList.toggle("low-light");

  setTimeout(() => {
    generateCalendar(); 
    highlightToday(); // âœ… CALL THIS after rebuild
  }, 100);
}


let selectedShortTermGoals = [];

document.addEventListener('DOMContentLoaded', function () {
  document.getElementById("menuButton").style.display = "none";
  const savedOrder = JSON.parse(localStorage.getItem('dashboardOrder') || '[]');
  if (savedOrder.length > 0) {
    savedOrder.forEach(cardId => {
      const card = dashboard.querySelector(`.card[data-card-id="${cardId}"]`);
      if (card) dashboard.appendChild(card);
    });
  }

  const storedUser = localStorage.getItem("lastUser");
  if (storedUser && localStorage.getItem("hasOnboarded_" + storedUser) === "true") {
    // ğŸ›  RENDER selected short-term habits into Today's Habits
    habits.length = 0;
    selectedShortTermGoals.forEach(goal => {
      habits.push({ name: goal, completed: false });
    });
    renderHabits();
    renderSocialPreview();

    // ğŸ›  SET HabitBot Chat area live
    const habitBotCard = document.querySelector('[data-card-id="habitbot"]');
    if (habitBotCard) {
      habitBotCard.innerHTML = `
        ğŸ¤– <h3>HabitBot Chat</h3>
        <textarea id="habitbot-dashboard-input" class="input" placeholder="What's going well? What's tough?" style="margin-bottom: 0.5rem; width:100%;"></textarea>
        <button class="btn-small" onclick="sendHabitBotMessage()">Send</button>
        <div id="habitbot-response" style="margin-top: 1rem; font-style: italic;"></div>


      `;
    }

      userName = storedUser;
      // Fill long-term goals
     // Load stored goals/motivation/shortterm habits
      selectedMotivations = JSON.parse(localStorage.getItem(`motivations_${userName}`) || "[]");
      selectedShortTermGoals = JSON.parse(localStorage.getItem(`shortterm_${userName}`) || "[]");
      
      // THEN render goals and motivations
      selectedGoals = JSON.parse(localStorage.getItem(`goals_${userName}`) || "[]");

      const goalList = document.getElementById("goal-list");
      goalList.innerHTML = "";
      selectedGoals.forEach(goal => {
        const li = document.createElement("li");
        li.innerHTML = `
          ${goal}
          <button onclick="addToGoogleCalendar('${goal}')" class="btn-small" style="margin-left:8px;">ğŸ“…</button>
        `;
        goalList.appendChild(li);
      });
      


      const motivationList = document.getElementById("motivation-list");
      motivationList.innerHTML = "";
      selectedMotivations.forEach(motivation => {
        const li = document.createElement("li");
        const tipText = getMotivationTip(motivation);
        li.innerHTML = `
          <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 0.3rem;">âœ¨ ${motivation}</div>
          <div id="tip-${motivation}" style="font-size: 0.95rem; color: #555;">${tipText}</div>
          <button class="btn-small" onclick="refreshMotivationTip('${motivation}')" style="margin-top: 0.25rem;">ğŸ”„ Refresh Tip</button>
          <hr style="margin: 0.75rem 0; border: 0; border-top: 1px solid #ccc;">
        `;

        motivationList.appendChild(li);
      });
      function refreshMotivationTip(m) {
      const tips = {
        "Tracking my progress visually": [
          "Use charts and streaks to track success.",
          "Create a sticker board or digital badge system.",
          "Make progress visible with a habit calendar."
        ],
        "Accountability from others": [
          "Check in with a friend weekly.",
          "Post progress in your social feed.",
          "Join a challenge group."
        ],
        "Clear rewards or milestones": [
          "Treat yourself to something small each week.",
          "Celebrate when you hit your streak goal.",
          "Set a reward for each milestone."
        ],
        "Visualizing success": [
          "Visualize the benefits of completing this habit.",
          "Picture the person you're becoming.",
          "Imagine how future-you feels after success."
        ],
        "Encouragement and affirmations": [
          "Write a kind note to future you.",
          "Post sticky notes with affirmations.",
          "Say a mantra aloud each morning."
        ],
        "Building habits into my routine": [
          "Anchor habits to another daily task.",
          "Use time-based reminders (e.g., after lunch).",
          "Set up automated cues like alarms or smart lights."
        ],
        "Still figuring it out": [
          "Try one new strategy per week.",
          "Journal whatâ€™s working and whatâ€™s not.",
          "Experiment with morning vs night routines."
        ]
      };
      
      const tipList = tips[m] || ["Keep experimenting!"];
      const newTip = tipList[Math.floor(Math.random() * tipList.length)];
      document.getElementById(`tip-${m}`).textContent = newTip;
    }

      function getMotivationTip(m) {
        const tips = {
          "Tracking my progress visually": "Use habit streaks, checklists, and charts to stay on track.",
          "Accountability from others": "Tell a friend or share updates in the social feed.",
          "Clear rewards or milestones": "Set up small rewards for completing habits weekly.",
          "Visualizing success": "Close your eyes and picture the end result daily.",
          "Encouragement and affirmations": "Write a morning mantra or self-kindness reminder.",
          "Building habits into my routine": "Tie your habit to an existing routine (e.g. after brushing teeth).",
          "Still figuring it out": "Try different strategies and reflect weekly on what helps."
        };
        return tips[m] || "Keep experimenting to see what works for you!";
      }


      selectedShortTermGoals = JSON.parse(localStorage.getItem(`shortterm_${userName}`) || "[]");
      habits.length = 0;
      selectedShortTermGoals.forEach(goal => {
        habits.push({ name: goal, completed: false });
      });
      renderHabits();

    
      document.getElementById("auth-section").style.display = "none";
      document.getElementById("login-section").style.display = "none";
      document.getElementById("onboarding").style.display = "none";
      document.getElementById("dashboard").style.display = "block";
    
  
      document.getElementById("userTitle").innerText = `${userName}'s habits`;
      document.getElementById("userTitle").style.display = "block";

      document.getElementById("menuButton").style.display = "block";



    // âœ… Safer show-input button
    const showInputButton = document.getElementById('show-input');
    if (showInputButton) {
      showInputButton.addEventListener('click', () => {
        const inputArea = document.getElementById('input-area');
        if (inputArea) {
          inputArea.style.display = 'flex';
        }
      });
    }

    // âœ… Safer add-habit button
    const addHabitButton = document.getElementById('add-habit');
    if (addHabitButton) {
      addHabitButton.addEventListener('click', () => {
        const input = document.getElementById('new-habit');
        const inputArea = document.getElementById('input-area');
        if (input && input.value.trim()) {
          habits.push({ name: input.value.trim(), completed: false });
          input.value = '';
          if (inputArea) inputArea.style.display = 'none';
          renderHabits();
        }
      });
    }

    // âœ… DELAYED animation for each card
    const cards = document.querySelectorAll('.card');
    cards.forEach((card, index) => {
      card.style.animationDelay = `${index * 0.2}s`;
    });
  }
});



</script>
  <div id="habitbotModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.4); z-index:9999; justify-content:center; align-items:center;">
  <div style="background:white; padding:2rem; border-radius:12px; max-width:600px; width:90%; box-shadow:0 8px 20px rgba(0,0,0,0.2);">
    <h3>ğŸ’¬ HabitBot Chat</h3>
    <textarea id="habitbot-input" class="input" placeholder="What's going well? What's tough?" style="width:100%; margin-bottom:1rem;"></textarea>
    <button class="btn-small" onclick="sendHabitBotMessage()">Send</button>
    <div id="habitbot-response" style="margin-top:1rem; font-style:italic;"></div>
    <br><button class="btn" style="margin-top:1rem;" onclick="closeHabitbotModal()">Close</button>
  </div>
</div>


</body>
</html>
